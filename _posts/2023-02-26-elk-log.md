---
title: "ë¡œê·¸ íŒŒì¼ì„ í‚¤ë°”ë‚˜ì™€ ì—°ë™í•˜ì—¬ ëª¨ë‹ˆí„°ë§í•˜ê¸°1 - Filebeat ì„¤ì¹˜ ë° Logstash, Kibana ì—°ë™"
excerpt: "ì—ëŸ¬ë¡œê·¸ì™€ ìŠ¬ë¡œìš° ì¿¼ë¦¬ë¥¼ í‚¤ë°”ë‚˜ë¡œ ì‹œê°í™”í•˜ì—¬ ì‰½ê³  ë¹ ë¥´ê²Œ ëª¨ë‹ˆí„°ë§ í•´ë³´ì"
categories:
  - ELK
tags:
  - ELK
  - Elasticsearch
  - Kibana
  - Logstash
  - Filebeat
toc: true
toc_sticky: true
toc_label: ëª©ì°¨
toc_icon: "list"
header:
  overlay_image: /assets/images/hero_background.jpg
  teaser: /assets/images/2023/02-26/header.png
---
<figure>
  <img src="https://blog.kakaocdn.net/dn/nDAqn/btrax65ihyO/DJZ4dYzphK06gHkDh3Ktw1/img.png">
</figure>

ELK(ì—˜ë¼ìŠ¤í‹±ìŠ¤íƒ)ìœ¼ë¡œ ìš°ë¦¬ëŠ” ê²€ìƒ‰ ë¿ë§Œ ì•„ë‹ˆë¼ íŒŒì¼ì„ ìˆ˜ì§‘í•˜ê³  ë°ì´í„°ë¥¼ ì •í˜•í™”í•˜ì—¬ ì‹œê°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì‚¬ë‚´ì—ì„œ ê·¸ë™ì•ˆ íŒŒì¼ë¡œë§Œ ìŒ“ê³  ìˆë˜ `ì—ëŸ¬ ë¡œê·¸`ì™€ `ì¿¼ë¦¬ ë¡œê·¸`ë¥¼ ìˆ˜ì§‘í•˜ì—¬ Kibanaë¡œ ì‹¤ì‹œê°„ ì—ëŸ¬ì™€ ìŠ¬ë¡œìš° ì¿¼ë¦¬ë¥¼ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆë„ë¡ ì ìš©í•˜ì—¬ ê·¸ ê³¼ì •ì„ ì •ë¦¬í•´ë³´ë ¤ í•©ë‹ˆë‹¤.


## ì—˜ë¼ìŠ¤í‹±ìŠ¤íƒìœ¼ë¡œ ë¡œê·¸íŒŒì¼ì„ ì½ëŠ”ë‹¤?
ì„œë²„ì— Filebeatë¥¼ ì„¤ì¹˜í•˜ê³  ì„¤ì •ì„ í•´ì£¼ë©´ `Filebeat`ëŠ” ì§€ì •í•œ ë¡œê·¸ íŒŒì¼ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€ê²½ì‚¬í•­ì„ ì²´í¬í•˜ì—¬ ì´ë²¤íŠ¸ë¥¼ `ìˆ˜ì§‘`í•˜ê³  íŒŒì¼ ë‚´ìš©ê³¼ offsetì„ Elasticsearchë‚˜ Logstash ë“± ì›í•˜ëŠ” outputìœ¼ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. <br>
ê¸°ë³¸ì ìœ¼ë¡œ ë¼ì¸ë³„ë¡œ ë³´ë‚´ì§€ë§Œ ì„¤ì •ì„ í†µí•˜ì—¬ ë©€í‹°ë¼ì¸ìœ¼ë¡œ ì „ì†¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. <br>

`Logstash`ëŠ” Filebeatë¡œë¶€í„° ë°ì´í„°ë¥¼ ì½ì–´ì™€ ì›í•˜ëŠ” ëª¨ì–‘ìœ¼ë¡œ `ê°€ê³µ`í•˜ì—¬ Elasticsearchë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ë¼ì¸ì„ grokë¡œ íŒŒì‹±í•´ì„œ í•„ë“œë³„ë¡œ ì‹ë³„í•˜ê³ , ë¶ˆí•„ìš”í•œ í•„ë“œëŠ” ì œê±°í•©ë‹ˆë‹¤. <br>


> âœ… Beatsì™€ Logstash <br>
> **Filebeat**ë€ ë¡œê·¸ì™€ íŒŒì¼ì„ ê²½ëŸ‰í™”ëœ ë°©ì‹ìœ¼ë¡œ ì „ë‹¬í•˜ê³  ì¤‘ì•™ ì§‘ì¤‘í™”í•˜ëŠ” [ê²½ëŸ‰ ë¡œê·¸ ìˆ˜ì§‘ê¸°](https://www.elastic.co/kr/beats/filebeat)ì…ë‹ˆë‹¤. <br>
> **Beats**ëŠ” ê°€ë²¼ìš´ í”„ë¡œê·¸ë¨ì„ ì§€í–¥í•˜ê¸° ë•Œë¬¸ì— **â€œë°ì´í„° ìˆ˜ì§‘â€**ì˜ ëª©ì ë§Œì„ ìˆ˜í–‰í•˜ëŠ”ë° íŠ¹í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.  <br>
> ë°˜ë©´ LogstashëŠ” ë‹¤ì–‘í•œ í”ŒëŸ¬ê·¸ì¸ì„ í¬í•¨í•´ ë²”ìš©ì„±ì´ ë†’ì€ ë§Œí¼ ë¬´ê²ê²Œ ì›€ì§ì…ë‹ˆë‹¤. <br>
> ê°„ë‹¨í•œ ìˆ˜ì§‘ì´ë¼ë©´ beatsì—ì„œë„ ì–´ëŠì •ë„ì˜ ë°ì´í„° ê°€ê³µì„ ì§€ì›í•˜ê¸° ë•Œë¬¸ì— beatsë§Œì„ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ì¢€ ë” ì „ë¬¸ì ì´ë¡œ ë²”ìš©ì ì¸ ëŒ€ëŸ‰ ì´ë²¤íŠ¸ ê°€ê³µì´ í•„ìš”í•˜ë‹¤ë©´ Logstashê°€ ì í•©í•©ë‹ˆë‹¤. <br>

## êµ¬ì¡°
<figure>
  <img src='https://user-images.githubusercontent.com/58028215/221415808-4e19be8b-5c00-46cb-a921-3052bcc3db0e.png' width="600" />
  <figcaption> ë¡œê·¸ íŒŒì¼ - Filebeat - Logstash - ES</figcaption>
</figure>
ê²€ìƒ‰ì—”ì§„ì„ ì‚¬ìš©í•˜ê³  ìˆì–´ì„œ ì´ë¯¸ DBì™€ ì—°ê²°ëœ Logstash pipelineì´ ì¡´ì¬í•œ ìƒíƒœì˜€ìŠµë‹ˆë‹¤. 
ë”°ë¼ì„œ ë¡œê·¸ íŒŒì¼ì„ ë°›ëŠ” pipelineì„ í•˜ë‚˜ ë” ìƒì„±í•˜ì—¬ ESë¡œ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ Logstashì— `ë‹¤ì¤‘ íŒŒì´í”„ë¼ì¸` ì„¤ì •ì„ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. 

## Filebeatë¡œ ë¡œê·¸ íŒŒì¼ ì½ê¸°
### Filebeat ì„¤ì¹˜
[Filebeat quick start: installation and configuration | Filebeat Reference [8.6] | Elastic](https://www.elastic.co/guide/en/beats/filebeat/8.6/filebeat-installation-configuration.html)

ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ì„¤ì¹˜í•©ë‹ˆë‹¤. ì €ëŠ” ë‹¤ë¥¸ ì—˜ë¼ìŠ¤í‹±ìŠ¤íƒ ë²„ì „ê³¼ ë§ì¶”ê¸° ìœ„í•´ `**Filebeat 7.15.2 ë²„ì „**`ì„ ì„¤ì¹˜í–ˆìŠµë‹ˆë‹¤. 

### Filebeat ì„¤ì •
1. filebeat.yml íŒŒì¼ì˜ ë‚´ìš©ì„ ìˆ˜ì •í•©ë‹ˆë‹¤
    
    ```bash
    # ============================== Filebeat inputs ===============================
    
    filebeat.inputs:
    - type: log
    
      # Change to true to enable this input configuration.
      enabled: true
    
      # Paths that should be crawled and fetched. Glob based paths.
      paths:
       - [ë¡œê·¸ê²½ë¡œ]/ERROR*.log
       # - /var/log/*.log
        #- c:\programdata\elasticsearch\logs\*
    
      ### Multiline options
    
      # Multiline can be used for log messages spanning multiple lines. This is common
      # for Java Stack Traces or C-Line Continuation
    
      # The regexp Pattern that has to be matched. The example pattern matches all lines starting with [
      multiline.pattern: '^[#][SF]#'
    
      # Defines if the pattern set under pattern should be negated or not. Default is false.
      multiline.negate: true
      multiline.match: after
    
    # filestream is an input for collecting log messages from files. It is going to replace log input in the future.
    - type: filestream
    
      # Change to true to enable this input configuration.
      enabled: false
    
      # Paths that should be crawled and fetched. Glob based paths.
      paths:
        - /var/log/*.log
    
    # ============================== Filebeat modules ==============================
    
    filebeat.config.modules:
      # Glob pattern for configuration loading
      path: ${path.config}/modules.d/*.yml
    
      # Set to true to enable config reloading
      reload.enabled: false
    
      # Period on which files under path should be checked for changes
      #reload.period: 10s
    # ================================== Outputs ===================================
    
    # Configure what output to use when sending the data collected by the beat.
    
    # ---------------------------- Elasticsearch Output ----------------------------
    #output.elasticsearch:
      # Array of hosts to connect to.
     # hosts: ["localhost:6001"]
    
      # Protocol - either `http` (default) or `https`.
      #protocol: "https"
    
      # Authentication credentials - either API key or username/password.
      #api_key: "id:api_key"
      #username: "elastic"
      #password: "changeme"
    
    # ------------------------------ Logstash Output -------------------------------
    output.logstash:
      # The Logstash hosts
      hosts: ["localhost:6022"]
    # ======================= Elasticsearch template setting =======================
    
    setup.template.settings:
      index.number_of_shards: 1
      #index.codec: best_compression
      #_source.enabled: false
    
    # =================================== Kibana ===================================
    
    # Starting with Beats version 6.0.0, the dashboards are loaded via the Kibana API.
    # This requires a Kibana endpoint configuration.
    setup.kibana:
      host: "localhost:6002"
    # ================================= Processors =================================
    processors:
      - add_host_metadata:
          when.not.contains.tags: forwarded
      - add_cloud_metadata: ~
      - add_docker_metadata: ~
      - add_kubernetes_metadata: ~
    ```
    
    - multi line ì„¤ì • : ì´ë¥¼ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ë¡œê·¸íŒŒì¼ì„ í•œ ì¤„ ì”© ì „ì†¡í•˜ê¸° ë•Œë¬¸ì— í•œ ê±´ì˜ ì—ëŸ¬ ë¡œê·¸ê°€ í•œ ì¤„ì”©, ë¡œê·¸ì˜ ë¼ì¸ìˆ˜ë§Œí¼ ESì— ìŒ“ì´ê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ, `ë©€í‹° ë¼ì¸ ì„¤ì •`ê³¼ `íŒ¨í„´ ì •ê·œì‹`ì„ ì´ìš©í•˜ì—¬ ë¡œê·¸ì˜ ë²”ìœ„ë¥¼ ì •í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
        - ë‹¤í–‰íˆ ì‚¬ë‚´ ë¡œê·¸ëŠ” ëª¨ë“  ë¡œê·¸ì˜ í˜•ì‹ì´ í•œ ê°€ì§€ë¡œ ì¼ì •í•˜ê¸° ë•Œë¬¸ì— `íŒ¨í„´`ì„ ëª…ì‹œí•˜ì˜€ìŠµë‹ˆë‹¤. 
        ë§Œì•½ ë‹¤ì–‘í•œ íŒ¨í„´ì´ì—ˆë‹¤ë©´ logbackì˜ appenderì— json í˜•íƒœë¡œ ë¡œê·¸ë¥¼ ì ì¬í•˜ì—¬ ESë¡œ ë°”ë¡œ ì˜ëŠ” í˜•ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - Logstashë¡œ ê±°ì¹˜ë„ë¡ ë³€ê²½í–ˆê¸° ë•Œë¬¸ì— Outputì„¤ì •ì„ **output.logstash: hosts: ["localhost:6022"]** ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
        - í¬íŠ¸ë²ˆí˜¸ 6022ëŠ” ì„ì˜ë¡œ ì§€ì •í–ˆìŠµë‹ˆë‹¤. í›„ì— Logstashì—ì„œ ì´ í¬íŠ¸ë²ˆí˜¸ë¡œ ì…ë ¥ì„ ë°›ìŠµë‹ˆë‹¤. ( ì°¸ê³ ë¡œ ê²€ìƒ‰ì—”ì§„ ë¡œê·¸ìŠ¤íƒœì‹œ í¬íŠ¸ëŠ” 6012)

2. ì´ˆê¸° í™˜ê²½ ì„¤ì • ( ì´ˆê¸° í•œ ë²ˆ )
    
    ```bash
    ./filebeat setup -e
    ```
    FilebeatëŠ” Elasticsearchë¡œ ìƒ‰ì¸ ì‹œ ê¶Œì¥ë˜ëŠ” ì¸ë±ìŠ¤ êµ¬ì„±ì„ ë‹´ì€ ê¸°ë³¸ ì¸ë±ìŠ¤ í…œí”Œë¦¿, ì¸ë±ìŠ¤ ìˆ˜ëª… ì£¼ê¸° ê´€ë¦¬ ì •ì±…, Kibana ëŒ€ì‹œë³´ë“œ ë“±ì„ ë¶ˆëŸ¬ì™€ ì„¤ì •í•©ë‹ˆë‹¤. 
  <figure>
    <img src='https://user-images.githubusercontent.com/58028215/221417872-e9c8c973-db82-4845-baa6-03b16a26c3ce.png'/>
  </figure>

## Logstashì—ì„œ ì‹œê°í™”í•  ë°ì´í„°ë§Œ ë½‘ì•„ ì¬êµ¬ì„±í•˜ê¸°
### ì—ëŸ¬ ë¡œê·¸ filebeatì˜ íŒŒì´í”„ë¼ì¸ ì„¤ì •
ìƒˆë¡œ ì¶”ê°€í•  íŒŒì´í”„ë¼ì¸ì„ ì„¤ì •í•©ë‹ˆë‹¤. ì´ë¦„ì€ ì„ì˜ë¡œ **logstash_err.conf** ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤.

[Logstashê²½ë¡œ]/config/**logstash_err.conf**

```bash
input {
    beats {
        port => 6022
    }
}

filter {

}

output {
        elasticsearch {
                hosts => ["localhost:6001"]
                index => "filebeat-err"
        }
}
```

### pipelines ì„¤ì •

ì•ì„œ ì„¤ì •í•œ íŒŒì´í”„ë¼ì¸ê³¼ ê¸°ì¡´ì— ì¡´ì¬í•˜ë˜ íŒŒì´í”„ë¼ì¸ì„ í•¨ê»˜ ì„¤ì •í•©ë‹ˆë‹¤. 

[pipeline.id](http://pipeline.id)ëŠ” ìœ ë‹ˆí¬í•œ ê°’ì´ì–´ì•¼ í•©ë‹ˆë‹¤. 

[Logstashê²½ë¡œ]/config/**pipelines.yml**
```bash
# List of pipelines to be loaded by Logstash
#
# This document must be a list of dictionaries/hashes, where the keys/values are pipeline settings.
# Default values for omitted settings are read from the `logstash.yml` file.
# When declaring multiple pipelines, each MUST have its own `pipeline.id`.
#
# Example of two pipelines:
#
 - pipeline.id: pipe-1
   path.config: "[ë¡œê·¸ìŠ¤íƒœì‹œ ê²½ë¡œ]/config/logstash.conf"
 - pipeline.id: pipe-2
   path.config: "[ë¡œê·¸ìŠ¤íƒœì‹œ ê²½ë¡œ]/config/logstash_err.conf"

# ... í›„ëµ
```
- idì™€ ê²½ë¡œëŠ” ê°ìì— ë§ê²Œ ë³€ê²½í•˜ì—¬ ì„¤ì •í•©ë‹ˆë‹¤

### ë¡œê·¸ìŠ¤íƒœì‹œ ì‹¤í–‰

> ğŸª´ Logstashì™€ filebeat ì‹¤í–‰ ìˆœì„œ <br>
> 
> : Logstashë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì—¬ ëŒ€ê¸° ìƒíƒœë¡œ ë§Œë“  í›„ filebeatë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. 


ì‹¤í–‰ì€ ë‹¤ì¤‘ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ë¡œê·¸ìŠ¤íƒœì‹œê°€ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. 

ë”°ë¼ì„œ ê¸°ì¡´ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •íŒŒì¼ì„ ì§€ì •í•´ì„œ ì‹¤í–‰í–ˆì§€ë§Œ

```bash
nohup bin/logstash -f ./config/logstash.conf &
```

ì´ì œëŠ” **`ë‹¤ì¤‘ íŒŒì´í”„ë¼ì¸ì˜ ì†ì„±`ì„ ì½ì–´ì„œ ì‹¤í–‰**í•´ì•¼ í•©ë‹ˆë‹¤. -f ì˜µì…˜ì„ ì£¼ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ pipelines ì„¤ì •ì„ ì½ìŠµë‹ˆë‹¤.

```bash
nohup bin/logstash &
```
### Filebeatì‹¤í–‰

ì„¤ì • í›„ ìµœì´ˆì— ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤. 

```bash
sudo chown root filebeat.yml
sudo ./filebeat run &
```


## Kibanaë¡œ ì‹œê°í™”í•˜ê¸°
ì›¹ë¸Œë¼ìš°ì €ë¡œ í‚¤ë°”ë‚˜ì— ì ‘ì†í•©ë‹ˆë‹¤. <br>
`Analytics` > `Discover` ì—ì„œ 16:00 ~ 16:30 ì‚¬ì´ì˜ ë¡œê·¸ë¥¼ í™•ì¸í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë‘ ê±´ì´ ë“¤ì–´ì™€ ìˆìŠµë‹ˆë‹¤. 
<figure>
  <img src='https://user-images.githubusercontent.com/58028215/221417467-79ea721f-d45e-4d93-b2f0-945ba0d0730c.png'/>
</figure>

ì´ëŸ¬í•œ ê²°ê³¼ëŠ” `Observability` > `Logs` ì—ì„œë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<figure>
  <img src='https://user-images.githubusercontent.com/58028215/221417657-07a8dfc8-4da5-4eab-8c7c-45ab352bf704.png'/>
</figure>
ìœ„ì˜ í™”ë©´ì€ Highlightsì— â€œexceptionâ€ ì„ ì…ë ¥í•˜ì—¬ exception í‚¤ì›Œë“œì— í•˜ì´ë¼ì´íŠ¸ë¥¼ ì¤€ ëª¨ìŠµì…ë‹ˆë‹¤.

í˜„ì¬ í™”ë©´ì—ì„œ ë³´ì´ëŠ” ë¡œê·¸ëŠ” í•„ìš”í•˜ì§€ ì•Šì€ í•„ë“œë„ ë§ê³ , ì—ëŸ¬ë©”ì‹œì§€ê°€ message í•„ë“œ í•˜ë‚˜ì— í†µì§¸ë¡œ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œëŠ” ìˆ˜ì§‘í•œ ë¡œê·¸ íŒŒì¼ì„ ì¢€ ë” ëª…í™•í•˜ê³  ì—ëŸ¬ì‚¬í•­ì„ íŒŒì•…í•˜ê¸° ì‰½ë„ë¡ **1) í•„ìš”í•œ í•„ë“œë§Œ ë‚¨ê²¨ë‘ê³ , 2) message í•„ë“œì˜ ê°’ì„ ì„¸ë¶€ì ìœ¼ë¡œ ë¶„ë¦¬**í•˜ê² ìŠµë‹ˆë‹¤. 

## ì°¸ê³ 
[ELK êµ¬ì¶• ë¶€í„° log íŒŒì‹±, ì ì¬ ê¹Œì§€ (with SpringBoot)](https://umbum.dev/1144)

[ğŸ“š Elastic Stackìœ¼ë¡œ ë‚´ Appì˜ Logë¥¼ ê´€ë¦¬í•´ë³´ì(2) - Filebeatë¡œ ìˆ˜ì§‘í•˜ê³  Kibanaì—ì„œ í™•ì¸í•˜ê¸°](https://www.gimsesu.me/manage-logs-with-elastic-stack-2)

[[ELK] ELK Stackì„ êµ¬ì¶•í•´ ë³´ì - ë¡œê·¸ íŒŒì¼ ìˆ˜ì§‘í•˜ê¸°](https://steady-hello.tistory.com/92)

[[Elastic Stack] Filebeat LogBack multiline pattern ì ìš©í•˜ê¸°](https://velog.io/@juhwanheo/Elastic-Stack-Filebeat-LogBack-multiline-pattern-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0)